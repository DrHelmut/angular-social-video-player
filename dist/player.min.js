var DAILYMOTION_API,YOUTUBE_API,app,videoPlayer;app=angular.module("socialVideoPlayer",[]),YOUTUBE_API="https://www.youtube.com/iframe_api",DAILYMOTION_API="https://api.dmcdn.net/all.js",videoPlayer=function(e,i,t,o,d){var a,r,n,u,l,v;return r=e[0],v={},n=!1,l=function(){var e,i;return i=null,"undefined"==typeof YT&&(i=u(YOUTUBE_API)),"undefined"==typeof DM&&(i=i?i.then(function(){return u(DAILYMOTION_API)}):u(DAILYMOTION_API)),i||(e=d.defer(),e.resolve(),i=e.promise),i},u=function(e){var i,o;return i=d.defer(),o=null,o=a(e),o.onload=o.onreadystatechange=function(e){return o.readyState&&"complete"!==o.readyState&&"loaded"!==o.readyState?!1:void t(function(){i.resolve(e)})},o.onerror=function(e){i.reject(e)},i.promise},a=function(e){var i;return i=r.createElement("script"),i.src=e,r.body.appendChild(i),i},{restrict:"AE",scope:{videoId:"@videoId",videoProvider:"@videoProvider",autoPlay:"@autoPlay",width:"=",height:"=",pause:"@pause"},link:function(e,d){var a,u,s,c;a=function(){var i;return i=angular.element('<div id="videoPlayer"/>'),o(i)(e),d.children().remove(),d.append(i),delete v.google,DM?(v.dailymotion=DM.player(r.getElementById("videoPlayer"),{video:e.videoId,width:e.width,height:e.height,params:{autoplay:"true"===e.autoPlay,mute:!1,api:"1"}}),v.dailymotion.addEventListener("ended",function(){return e.$emit("videoFinished")}),v.dailymotion.addEventListener("apiready",function(){}),v.dailymotion.addEventListener("playing",function(){return e.$emit("videoStarted")}),v.dailymotion.addEventListener("pause",function(){return e.$emit("videoPaused")}),"true"!==e.autoPlay?e.$emit("videoPaused"):void 0):void 0},s=function(){var t;return t=angular.element('<div id="videoPlayer"/>'),o(t)(e),d.children().remove(),d.append(t),delete v.dailymotion,YT?YT.loaded?c():YT.ready(c):i.onYouTubePlayerAPIReady=c},c=function(){return v.google=new YT.Player(r.getElementById("videoPlayer"),{height:e.height,width:e.width,videoId:e.videoId,events:{onReady:function(i){return"true"===e.autoPlay?(i.target.playVideo(),e.$emit("videoStarted")):e.$emit("videoPaused")},onStateChange:function(i){switch(i.data){case 0:return e.$emit("videoFinished");case 1:return e.$emit("videoStarted");case 2:return e.$emit("videoPaused")}}}})},u=function(){var i,t,a,u,l;u="*",i=angular.element('<iframe id="videoPlayer" src="https://player.vimeo.com/video/'+e.videoId+'?api=1&player_id=videoPlayer" width="'+e.width+'" height="'+e.height+'" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen/>'),o(i)(e),d.children().remove(),d.append(i),v.vimeo=r.getElementById("videoPlayer"),t=function(i){var t;if(!/^https?:\/\/player.vimeo.com/.test(i.origin))return!1;switch("*"===u&&(u=i.origin),t=JSON.parse(i.data),t.event){case"ready":return a();case"play":return e.$emit("videoStarted");case"pause":return e.$emit("videoPaused");case"finish":return e.$emit("videoFinished")}},n||(window.addEventListener?(window.addEventListener("message",t,!1),n=!0):window.attachEvent("onmessage",t,!1)),l=function(e,i){var t,o;return t={method:e},i&&(t.value=i),o=JSON.stringify(t),v.vimeo.contentWindow.postMessage(o,u)},v.vimeo.post=l,a=function(){return l("addEventListener","pause"),l("addEventListener","finish"),l("addEventListener","play"),"true"===e.autoPlay?l("play"):e.$emit("videoPaused")}},l().then(function(){var i;switch(i=angular.element('<div id="videoPlayer"/>'),o(i)(e),d.append(i),e.videoProvider){case"google":return s();case"dailymotion":return a();case"vimeo":return u()}}),e.$watch("videoProvider",function(e,i){if(e!==i)switch(e){case"google":case"youtube":return s();case"dailymotion":return a();case"vimeo":return u()}}),e.$watch("videoId",function(i,o){return i!==o?("google"===e.videoProvider||"youtube"===e.videoProvider?v.google&&v.google.loadVideoById?"true"===e.autoPlay?v.google.loadVideoById(e.videoId):v.google.cueVideoById(e.videoId):s():"dailymotion"===e.videoProvider?v.dailymotion?v.dailymotion.load(e.videoId,{autoplay:"true"===e.autoPlay}):a():"vimeo"===e.videoProvider&&u(),"true"!==e.autoPlay?t(function(){return e.$emit("videoPaused")}):void 0):void 0}),e.$watch("pause",function(i,t){if(i!==t)switch(e.videoProvider){case"google":case"youtube":return"true"===i?v.google.pauseVideo():v.google.playVideo();case"dailymotion":return"true"===i?v.dailymotion.pause():v.dailymotion.play();case"vimeo":return"true"===i?v.vimeo.post("pause"):v.vimeo.post("play")}}),e.$on("$destroy",function(){return v={}})}}},app.directive("svPlayer",["$document","$window","$timeout","$compile","$q",videoPlayer]);